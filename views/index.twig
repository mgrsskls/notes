{% extends "html.twig" %}

{% block head %}
  <link rel="stylesheet" href="index.css">
{% endblock %}

{% block content %}
  <header class="AddNote u-flex-col">
    <h1><a href="/">Notes</a></h1>
    <form class="Add u-flex-col u-flex-grow" action="/" method="post">
      {% if edit %}
        <input type="hidden" name="id" value="{{ edit.id }}">
      {% endif %}
      <div class="Input">
        <label class="Input-label" for="title">{{ 'note.attributes.title'|t }}</label>
        <input class="Input-element" type="text" name="title" id="title" value="{{ edit.title }}">
      </div>
      <div class="Input">
        <label class="Input-label" for="url">{{ 'note.attributes.url'|t }}</label>
        <input class="Input-element" type="text" name="url" id="url" value="{{ edit.url }}">
      </div>
      <div class="Input u-flex-col u-flex-grow">
        <label class="Input-label" for="text">{{ 'note.attributes.text'|t }}</label>
        <textarea class="Input-element u-flex-grow" name="text" id="text">{{ edit.text }}</textarea>
      </div>
      <div class="Input">
        <label class="Input-label" for="tag">{{ 'note.attributes.tags'|t }}</label>
        <input class="Input-element" type="text" list="tags" id="tag">
        <datalist id="tags">
          {% for tag in tags %}
            <option value="{{ tag }}">
          {% endfor %}
        </datalist>
        <ul class="Add-tags Tags">
          {% for tag in edit.tags %}
            <li class="Add-tag">
              <input type="hidden" name="tags[]" value="{{ tag }}">
              <button class="Button Button--tertiary Button--small Button--delete Tag" type="button">{{ tag }}</button>
            </li>
          {% endfor %}
          <template id="tag-template">
            <li class="Add-tag">
              <input type="hidden" name="tags[]">
              <button class="Button Button--tertiary Button--small Button--delete Tag" type="button"></button>
            </li>
          </template>
        </ul>
      </div>
      <div class="Input">
        <button class="Button Button--primary Button--large" type="submit"{% if edit %} name="update"{% endif %}>{{ edit ? 'note.update.submit'|t : 'note.create.submit'|t }}</button>
        {% if edit %}
          <a class="Add-cancel" href="/">{{ 'note.update.cancel'|t }}</a>
        {% endif %}
      </div>
    </form>
  </header>
  <main class="Content u-flex-col">
    <div class="FilterSearch">
      <form class="Search">
        <label for="query">{{ 'search.label'|t }}</label>
        <input class="Search-input" type="search" name="query" id="query" value="{{ query }}">
        <button class="Search-button Button Button--primary Button--large" type="submit">{{ 'search.submit'|t }}</button>
      </form>
      {% if activeTags|length > 0 %}
        <div class="ActiveTags FilterSearch-activeTags">
          <p class="ActiveTags-label">{{ 'filter.label'|t }}</p>
          <ul class="ActiveTags-list Tags">
            {% for activeTag in activeTags %}
              <li>
                <form>
                  {% for tag in activeTags %}
                    {% if activeTag != tag %}
                      <input type="hidden" name="tags[]" value="{{ tag }}">
                    {% endif %}
                  {% endfor %}
                  <button type="submit" class="Button Button--secondary Button--small Button--delete Tag">{{ activeTag }}</button>
                </form>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
    {% if notes|length > 0 %}
    <div class="Main u-flex-grow">
      <table class="Table">
        <thead>
          <tr>
            <th>{{ 'note.attributes.title'|t }}</th>
            <th>{{ 'note.attributes.url'|t }}</th>
            <th>{{ 'note.attributes.text'|t }}</th>
            <th>{{ 'note.attributes.tags'|t }}</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for note in notes %}
          <tr class="Note">
            <td class="Note-value">
              {{ note.title }}
            </td>
            <td class="Note-value">
              {% if note.url %}
                <a href="{{ note.url }}" target="_blank" rel="noopener noreferrer">{{ note.url }}</a>
              {% endif %}
            </td>
            <td class="Note-value">
              <div class="RichText">
                {{ note.text }}
              </div>
            </td>
            <td>
              {% if note.tags|length > 0 %}
                <ul class="Tags">
                  {% for tag in note.tags %}
                    <li>
                      <form>
                        {% if tag in activeTags %}
                          {% for activeTag in activeTags %}
                            {% if activeTag != tag %}
                              <input type="hidden" name="tags[]" value="{{ activeTag }}">
                            {% endif %}
                          {% endfor %}
                          <button class="Button Button--secondary Button--small Button--delete Tag" type="submit">{{ tag }}</button>
                        {% else %}
                          {% for activeTag in activeTags %}
                            <input type="hidden" name="tags[]" value="{{ activeTag }}">
                          {% endfor %}
                          <button class="Button Button--secondary Button--small Tag" type="submit" name="tags[]" value="{{ tag }}">{{ tag }}</button>
                        {% endif %}
                      </form>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </td>
            <td class="Add-actions">
              <a href="/?edit={{ note.id }}">{{ 'note.update.link'|t }}</a> &middot; <form action="/" method="POST">
                <input type="hidden" value="{{ note.id }}" name="id">
                <button class="DeleteButton" type="submit" name="delete" aria-label="{{ 'note.delete.submit'|t }}">
                  {{ 'note.delete.submit'|t }}
                </button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </main>
{% endblock %}
